<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin ‚Äî –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</title>
  <link rel="stylesheet" href="admin.css">
  <style>
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
    #login-overlay {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    #login-box {
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      max-width: 320px;
      width: 100%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      text-align: center;
    }
    #login-box h2 {
      margin-bottom: 1rem;
    }
    #login-box input {
      width: 100%;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #login-box button {
      margin-top: 1rem;
      width: 100%;
      padding: 0.5rem;
      background: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #login-error {
      color: red;
      font-size: 0.9rem;
      height: 1.2rem;
    }
    body.locked {
      overflow: hidden;
    }
  </style>
</head>
<body class="locked">

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
  <div id="login-overlay">
    <div id="login-box">
      <h2>–î–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ IP –∞–¥—Ä–µ—Å—É</h2>
      <div id="login-error"></div>
      <input type="text" id="login-user" placeholder="–õ–æ–≥—ñ–Ω" autofocus>
      <input type="password" id="login-pass" placeholder="–ü–∞—Ä–æ–ª—å">
      <button id="login-btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ </button>
    </div>
  </div>

  <div class="container">
    <h1 class="title">EBA$H KE$H</h1>

    <!-- –§–æ—Ä–º–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è -->
    <section class="card">
      <h2 class="card__title">–î–æ–±–∞–≤—å –º–∞–º–æ–Ω—Ç–∞ —á—Ç–æ–± –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å </h2>
      <form id="form-new" class="form-grid">
        <label>–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: <input name="ipp" required></label>
        <label>–ü–Ü–ë: <input name="fullName"></label>
        <label>–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: <input type="date" name="birthDate"></label>
        <label>–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: <input type="date" name="registrationDate"></label>
        <label>–ù–æ–º–µ—Ä –¥–æ–∫.: <input name="docNumber"></label>
        <label>–°—Ç–∞—Ç—É—Å:
          <select name="status">
            <option>‚Äî</option>
            <option>O—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</option>
            <option>–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ</option>
            <option>–≤—ñ–¥—Ö–∏–ª–µ–Ω–æ</option>
          </select>
        </label>
        <button class="btn primary" type="submit">–°–û–ó–î–ê–¢–¨ –†–û–ì–ê–¢–û–ì–û </button>
      </form>
    </section>

    <!-- –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ -->
    <section class="card">
      <h2 class="card__title">–°–ü–ò–°–û–ö –ú–û–•–ù–ê–¢–´–•</h2>
      <div class="table-wrap">
        <table id="tbl-users">
          <thead>
            <tr>
              <th>#</th><th>ID</th><th>–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</th><th>–ü–Ü–ë</th>
              <th>–î–∞—Ç–∞ –Ω–∞—Ä.</th><th>–†–µ—î—Å—Ç—Ä.</th><th>–î–æ–∫—É–º–µ–Ω—Ç</th>
              <th>–°—Ç–∞—Ç—É—Å</th><th>–î—ñ—ó</th><th>–ü–µ—Ä–µ–≥–ª—è–¥</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
    <section class="card hidden" id="edit-card">
      <h2 class="card__title">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h2>
      <form id="form-edit" class="form-grid">
        <input type="hidden" name="id">
        <label>–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è : <input name="ipp" required></label>
        <label>–ü–Ü–ë: <input name="fullName"></label>
        <label>–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: <input type="date" name="birthDate"></label>
        <label>–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: <input type="date" name="registrationDate"></label>
        <label>–ù–æ–º–µ—Ä –¥–æ–∫.: <input name="docNumber"></label>
        <label>–°—Ç–∞—Ç—É—Å:
          <select name="status">
            <option>‚Äî</option>
            <option>O—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</option>
            <option>–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ</option>
            <option>–≤—ñ–¥—Ö–∏–ª–µ–Ω–æ</option>
          </select>
        </label>
        <div class="form-actions">
          <button class="btn primary" type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
          <button class="btn error" type="button" id="btn-cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
      </form>
    </section>
  </div>

  <script>
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    // –õ–æ–≥–∏–∫–∞ ¬´–º–æ–¥–∞–ª–∫–∏¬ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const overlay = document.getElementById('login-overlay');
    const userInp = document.getElementById('login-user');
    const passInp = document.getElementById('login-pass');
    const errDiv  = document.getElementById('login-error');
    const btn     = document.getElementById('login-btn');

    btn.onclick = () => {
      const u = userInp.value.trim();
      const p = passInp.value;
      if (u === 'admin' && p === '20482048') {
        overlay.style.display = 'none';
        document.body.classList.remove('locked');
      } else {
        errDiv.textContent = '–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å';
      }
    };

    passInp.addEventListener('keypress', e => {
      if (e.key === 'Enter') btn.click();
    });
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî

    // –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∞–¥–º–∏–Ω–∫–∏:
    const API       = '/api/users';
    const tblBody   = document.querySelector('#tbl-users tbody');
    const formNew   = document.getElementById('form-new');
    const formEdit  = document.getElementById('form-edit');
    const editCard  = document.getElementById('edit-card');
    const cancelBtn = document.getElementById('btn-cancel');

    async function loadUsers() {
      const users = await fetch(API).then(r=>r.json());
      tblBody.innerHTML = users.map((u,i)=>`
        <tr>
          <td>${i+1}</td>
          <td>${u.id}</td>
          <td>${u.ipp}</td>
          <td>${u.fullName||''}</td>
          <td>${u.birthDate||''}</td>
          <td>${u.registrationDate||''}</td>
          <td>${u.docNumber||''}</td>
          <td>${u.status||'‚Äî'}</td>
          <td>
            <button class="btn small" onclick="startEdit('${u.id}')">‚úé</button>
            <button class="btn small error" onclick="deleteUser('${u.id}')">üóë</button>
          </td>
          <td><a class="btn small" href="index.html?userId=${u.id}" target="_blank">üîó</a></td>
        </tr>`).join('');
    }

    formNew.onsubmit = async e => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(formNew));
      await fetch(API, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(data)
      });
      formNew.reset();
      loadUsers();
    };

    window.startEdit = async id => {
      const u = await fetch(`${API}/${id}`).then(r=>r.json());
      formEdit.id.value               = u.id;
      formEdit.ipp.value              = u.ipp;
      formEdit.fullName.value         = u.fullName;
      formEdit.birthDate.value        = u.birthDate;
      formEdit.registrationDate.value = u.registrationDate;
      formEdit.docNumber.value        = u.docNumber;
      formEdit.status.value           = u.status;
      editCard.classList.remove('hidden');
      window.scrollTo(0, editCard.offsetTop - 20);
    };

    formEdit.onsubmit = async e => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(formEdit));
      const id   = data.id; delete data.id;
      await fetch(`${API}/${id}`, {
        method:'PUT',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(data)
      });
      cancelEdit();
      loadUsers();
    };

    cancelBtn.onclick = cancelEdit;
    function cancelEdit(){
      formEdit.reset();
      editCard.classList.add('hidden');
    }

    async function deleteUser(id){
      if(!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞?')) return;
      await fetch(`${API}/${id}`,{method:'DELETE'});
      loadUsers();
    }

    loadUsers();
  </script>
</body>
</html>
